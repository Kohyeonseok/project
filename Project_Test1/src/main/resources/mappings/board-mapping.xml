<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardDAO">

	<select id="getHikingBoardList" resultType="board">
		SELECT * FROM HIKINGBOARD ORDER BY NO DESC LIMIT 10
		<if test="offset == -10">
        	OFFSET 0
    	</if>
    	<if test="offset != -10">
    		OFFSET #{offset}
    	</if>
	</select>

	<select id="getHikingBoard" resultType="board">
		<![CDATA[
			SELECT * FROM HIKINGBOARD WHERE NO=#{no}
		]]>
	</select>

	<select id="getSearchHikingBoard" resultType="board">
		SELECT * FROM HIKINGBOARD
		WHERE 1 = 1
		<if test="searchCategory == 'title'">
			AND TITLE LIKE CONCAT ('%', #{searchContent}, '%')
		</if>
		<if test="searchCategory == 'content'">
			AND CONTENT LIKE CONCAT ('%', #{searchContent}, '%')
		</if>
		ORDER BY NO DESC
	</select>

	<select id="countPost" resultType="int">
		<![CDATA[
			SELECT COUNT(*) FROM HIKINGBOARD
		]]>
	</select>

	<insert id="writeOkHikingBoard">
		<![CDATA[
			INSERT INTO HIKINGBOARD (ID, TITLE, CONTENT,FILENAME, CATEGORY) values(#{id},#{title},#{content},#{fileName},#{category})
		]]>
	</insert>

	<delete id="deleteHikingBoard">
		<![CDATA[
			DELETE FROM HIKINGBOARD WHERE NO=#{no}
		]]>
	</delete>

	<update id="updateOkHikingBoard">
		<![CDATA[
			UPDATE HIKINGBOARD SET title=CONCAT(#{title},'(수정)'), content=#{content}, wtime=CURRENT_TIMESTAMP, fileName=#{fileName} WHERE NO=#{no}
		]]>
	</update>

	<update id="updateHikingBoardHit">
		<![CDATA[
			UPDATE HIKINGBOARD SET HIT=HIT+1 WHERE NO=#{no}
		]]>
	</update>
	
	
	
	
	<insert id="inputReply">
		<![CDATA[
			INSERT INTO REPLY (POSTNO,ID,REPLYCONTENT,CATEGORY) VALUES(#{postNo},#{id},#{replyContent},#{category}) 
		]]>
	</insert>
	
	<select id="getBoardReply" resultType="reply">
		<![CDATA[
			SELECT * FROM REPLY WHERE POSTNO=${no} AND CATEGORY='${category}' ORDER BY NO ASC
		]]>
	</select>
	
	
	<insert id="reportBoard">
		<![CDATA[
			INSERT INTO REPORTBOARD (REPORTID,REPORTBOARDCATEGORY,REPORTBOARDNO,REPORTCATEGORY,REPORTCONTENT) VALUES(#{reportId},#{reportBoardCategory},#{reportBoardNo},#{reportCategory},#{reportContent})
		]]>
	</insert>
	
	<select id="getReportBoardList" resultType="board">
		<![CDATA[
			SELECT * FROM REPORTBOARD ORDER BY REPORTWTIME ASC;
		]]>
	</select>
	
	<delete id="adminDeleteBoard">
		<![CDATA[
			DELETE FROM ${category}BOARD WHERE NO=#{no}
		]]>
	</delete>
	
	<delete id="adminDeleteReport">
		<![CDATA[
			DELETE FROM REPORTBOARD WHERE reportNo=#{reportNo}
		]]>
	</delete>

</mapper>